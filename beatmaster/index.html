<!DOCTYPE html>
<html>
<head>
  <title>クリック音アプリ</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <div id="app" class="app"></div>

  <script>
    class SoundPlayer {
      constructor(src) {
        this.audio = new Audio(src);
        this.audio.preload = 'auto';
      }

      play() {
        this.audio.currentTime = 0;
        this.audio.play();
      }
    }

    class Timer {
      constructor(bpm, soundPlayer) {
        this.bpm = bpm;
        this.soundPlayer = soundPlayer;
        this.interval = null;
        this.isPlaying = false;
      }

      calculateInterval() {
        var millisecondsPerBeat = (60 / this.bpm) * 1000;
        return millisecondsPerBeat;
      }

      start() {
        if (this.isPlaying) {
          return;
        }
        var intervalDuration = this.calculateInterval();
        this.interval = setInterval(() => {
          this.soundPlayer.play();
        }, intervalDuration);

        this.isPlaying = true;
      }

      stop() {
        clearInterval(this.interval);
        this.interval = null;
        this.isPlaying = false;
      }

      updateBPM(newBPM) {
        this.bpm = newBPM;
        if (this.interval) {
          clearInterval(this.interval);
          this.isPlaying = false;
          this.start();
        } else {
          this.start();
        }
      }
    }

    var bpm = 120;
    var clickSound = new SoundPlayer('click_sound.mp3');
    var backSound = new SoundPlayer('back_sound.mp3');
    var timer = new Timer(bpm, clickSound);

    function createUI() {
      var appDiv = document.getElementById('app');

      var bpmDisplay = document.createElement('span');
      bpmDisplay.id = 'bpmDisplay';
      bpmDisplay.textContent = bpm;
      var bpmLabel = document.createElement('p');
      bpmLabel.textContent = 'BPM: ';
      bpmLabel.appendChild(bpmDisplay);

      var bpmSlider = document.createElement('input');
      bpmSlider.type = 'range';
      bpmSlider.id = 'bpmSlider';
      bpmSlider.min = '60';
      bpmSlider.max = '240';
      bpmSlider.value = bpm;
      bpmSlider.addEventListener('input', updateBPM);

      var startButton = document.createElement('button');
      startButton.textContent = 'Start';
      startButton.addEventListener('click', startTimer);

      var stopButton = document.createElement('button');
      stopButton.textContent = 'Stop';
      stopButton.addEventListener('click', stopTimer);

      var backButton = document.createElement('button');
      backButton.id = 'backButton';
      backButton.textContent = '裏';
      backButton.addEventListener('mousedown', function() {
        backSound.play();
      });

      appDiv.appendChild(bpmLabel);
      appDiv.appendChild(bpmSlider);
      appDiv.appendChild(startButton);
      appDiv.appendChild(stopButton);
      appDiv.appendChild(backButton);
    }

    createUI();

    function updateBPM() {
      var slider = document.getElementById('bpmSlider');
      var display = document.getElementById('bpmDisplay');
      bpm = parseInt(slider.value);
      display.textContent = bpm;
      timer.updateBPM(bpm);
    }

    function startTimer() {
      timer.start();
    }

    function stopTimer() {
      timer.stop();
    }

    function handleKeyDown(event) {
      if (event.keyCode === 32) {
        backSound.play();
      }
    }

    document.addEventListener('keydown', handleKeyDown);
  </script>
</body>
</html>
