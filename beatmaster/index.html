<!DOCTYPE html>
<html>
<head>
  <title>クリック音アプリ</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <div class="app">
    <p>BPM: <span id="bpmDisplay">120</span></p>
    <input type="range" id="bpmSlider" min="60" max="240" value="120" oninput="updateBPM()">
        
    <button onclick="startTimer()">Start</button>
    <button onclick="stopTimer()">Stop</button>
    <button id="backButton">裏</button>
  </div>

  <script>
  class SoundPlayer {
    constructor(src) {
      this.audio = new Audio(src);
      this.audio.preload = 'auto';
    }

    play() {
      this.audio.currentTime = 0;
      this.audio.play();
    }
  }

  class Timer {
    constructor(bpm, soundPlayer) {
      this.bpm = bpm;
      this.soundPlayer = soundPlayer;
      this.interval = null;
      this.isPlaying = false;
    }

    calculateInterval() {
      var millisecondsPerBeat = (60 / this.bpm) * 1000;
      return millisecondsPerBeat;
    }

    start() {
      if (this.isPlaying) {
        return;
      }
      var intervalDuration = this.calculateInterval();
      this.interval = setInterval(() => {
        this.soundPlayer.play();
      }, intervalDuration);

      this.isPlaying = true;
    }

    stop() {
      clearInterval(this.interval);
      this.interval = null;
      this.isPlaying = false;
    }

    updateBPM(newBPM) {
      this.bpm = newBPM;
      if (this.interval) {
        clearInterval(this.interval);
        this.isPlaying = false;
        this.start();
      } else {
        this.start();
      }
    }
  }

  var bpm = 120;
  var clickSound = new SoundPlayer('click_sound.mp3');
  var backSound = new SoundPlayer('back_sound.mp3');
  var timer = new Timer(bpm, clickSound);

  function startTimer() {
    timer.start();
  }

  function stopTimer() {
    timer.stop();
  }

  function updateBPM() {
    var slider = document.getElementById('bpmSlider');
    var display = document.getElementById('bpmDisplay');
    bpm = parseInt(slider.value);
    display.textContent = bpm;
    timer.updateBPM(bpm);
  }

  var backButton = document.getElementById('backButton');
  backButton.addEventListener('mousedown', function() {
    backSound.play();
  });

  function handleKeyDown(event) {
    if (event.keyCode === 32) {
      backSound.play();
    }
  }

  document.addEventListener('keydown', handleKeyDown);
  </script>
</body>
</html>