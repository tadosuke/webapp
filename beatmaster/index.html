<!DOCTYPE html>
<html>
<head>
  <title>クリック音アプリ</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <div class="app">
    <p>BPM: <span id="bpmDisplay">120</span></p>
    <input type="range" id="bpmSlider" min="60" max="240" value="120" oninput="updateBPM()">
        
    <button onclick="startTimer()">Start</button>
    <button onclick="stopTimer()">Stop</button>
    <button id="backButton">裏</button>
  </div>

  <script>
    class SoundPlayer {
      constructor(src) {
        this.audio = new Audio(src);
        this.audio.preload = 'auto';
      }

      play() {
        this.audio.currentTime = 0;
        this.audio.play();
      }
    }

    var bpm = 120;
    var interval;
    var clickSound = new SoundPlayer('click_sound.mp3');
    var backSound = new SoundPlayer('back_sound.mp3');
    var isPlaying = false;

    function calculateInterval() {
      var millisecondsPerBeat = (60 / bpm) * 1000;
      return millisecondsPerBeat;
    }

    function startTimer() {
      if (isPlaying) {
        return;
      }
      var intervalDuration = calculateInterval();
      interval = setInterval(function() {
        clickSound.play();
      }, intervalDuration);

      isPlaying = true;
    }

    function stopTimer() {
      clearInterval(interval);
      interval = null;
      isPlaying = false;
    }

    function updateBPM() {
      var slider = document.getElementById('bpmSlider');
      var display = document.getElementById('bpmDisplay');
      bpm = parseInt(slider.value);
      display.textContent = bpm;
      if (interval) {
        clearInterval(interval);
        isPlaying = false;
        startTimer();
      } else {
        startTimer();
      }
    }

    var backButton = document.getElementById('backButton');
    backButton.addEventListener('mousedown', function() {
      backSound.play();
    });

    function handleKeyDown(event) {
      if (event.keyCode === 32) {
        backSound.play();
      }
    }

    document.addEventListener('keydown', handleKeyDown);
  </script>

</body>
</html>