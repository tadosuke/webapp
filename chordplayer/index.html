<!DOCTYPE html>
<html>
<head>
    <title>Chord Player</title>
    <style>
        .grid-container {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 5px;
            padding: 5px;
        }
        .grid-item {
            border: 1px solid black;
            padding: 5px;
            text-align: center;
            cursor: pointer;
            color: black;
            font-size: 0.8em;
        }
    </style>
    <script src="https://unpkg.com/tone@14"></script>
</head>
<body>
    <div class="grid-container">
        <!-- コードボタンを配置 -->
    </div>

    <script>
        // コードのテーブルと取得処理を担当するクラス
        class ChordDictionary {
          constructor() {
            // 初期音程の定義
            this.initialPitch = {
              'C': 0,
              'C#': 1,
              'D': 2,
              'D#': 3,
              'E': 4,
              'F': 5,
              'F#': 6,
              'G': 7,
              'G#': 8,
              'A': 9,
              'A#': 10,
              'B': 11
            };
          }

          // バリエーションとキーに対応するコードの構成音リストを返すメソッド
          getChord(variation, key) {
            const intervals = this.getInterval(variation);
            const rootPitch = this.initialPitch[key];
            const chord = [];
            intervals.forEach(interval => {
              const pitch = (rootPitch + interval) % 12;
              const note = Object.keys(this.initialPitch).find(key => this.initialPitch[key] === pitch);
              chord.push(note + '4');
            });
            return chord;
          }

          // バリエーションに対応する相対音程のリストを返すメソッド
          getInterval(variation) {
            switch (variation) {
              case 'Major':
                return [0, 4, 7];
              case 'Minor':
                return [0, 3, 7];
              case '7':
                return [0, 4, 7, 10];
              case '6':
                return [0, 4, 7, 9];
              default:
                return [];
            }
          }
        }


        // コード再生処理を担当するクラス
        class ChordPlayer {
          constructor() {
            this.synth = new Tone.PolySynth().toDestination();
          }

          // コードを再生するメソッド
          playChord(chord) {
            this.synth.triggerAttackRelease(chord, '0.5s');
          }
        }

        // ボタンを生成するクラス
        class ButtonGenerator {
          constructor(variations, keys, colors, chordDictionary, chordPlayer, container) {
            this.variations = variations;
            this.keys = keys;
            this.colors = colors;
            this.chordDictionary = chordDictionary;
            this.chordPlayer = chordPlayer;
            this.container = container;
          }

          // ボタンを生成し、クリック時の処理を追加するメソッド
          generateButtons() {
            this.variations.forEach(variation => {
              this.keys.forEach((key, index) => {
                const button = document.createElement('div');
                button.classList.add('grid-item');
                button.textContent = `${key} ${variation}`;
                button.style.backgroundColor = this.colors[index % this.colors.length];

                button.addEventListener('click', () => {
                  const chord = this.chordDictionary.getChord(variation, key);
                  this.chordPlayer.playChord(chord);
                });

                this.container.appendChild(button);
              });
            });
          }
        }

        // ChordDictionaryクラスのインスタンスを作成
        const chordDictionary = new ChordDictionary();

        // ChordPlayerクラスのインスタンスを作成
        const chordPlayer = new ChordPlayer();

        // ボタン生成器のインスタンスを作成し、ボタンを生成
        const buttonGenerator = new ButtonGenerator(
          ['Major', 'Minor', '7', '6'],
          ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'],
          ['pink', 'peachpuff', 'palegoldenrod', 'palegreen', 'lightblue', 'plum', 'thistle'],
          chordDictionary,
          chordPlayer,
          document.querySelector('.grid-container')
        );
        buttonGenerator.generateButtons();

    </script>
</body>
</html>
